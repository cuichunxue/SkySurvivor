<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é£æœºèº²é¿æ¸¸æˆ</title>
<style>
body {
margin: 0;
padding: 0;
background: linear-gradient(135deg, #0f0f23, #1a1a3a);
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
font-family: Arial, sans-serif;
overflow: hidden;
touch-action: none;
}


#gameContainer {
position: relative;
width: 100vw;
height: 100vh;
max-width: 400px;
max-height: 600px;
background: radial-gradient(circle at center, #1a1a3a, #0f0f23);
border: 2px solid #444;
overflow: hidden;
}

#gameCanvas {
display: block;
background: transparent;
width: 100%;
height: 100%;
}

#ui {
position: absolute;
top: 20px;
left: 20px;
color: #fff;
font-size: 20px;
font-weight: bold;
text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
z-index: 10;
}

#gameOver {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: rgba(0, 0, 0, 0.9);
color: #fff;
padding: 30px;
border-radius: 15px;
text-align: center;
display: none;
z-index: 20;
}

#gameOver h2 {
margin: 0 0 20px 0;
color: #ff6b6b;
}

#gameOver h2.newRecord {
color: #44ff44;
animation: glow 1s ease-in-out infinite alternate;
}

@keyframes glow {
from { text-shadow: 0 0 10px #44ff44; }
to { text-shadow: 0 0 20px #44ff44, 0 0 30px #44ff44; }
}

#bestRecord {
font-weight: bold;
color: #ffd700;
}

#restartBtn {
background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
color: white;
border: none;
padding: 12px 24px;
font-size: 18px;
border-radius: 8px;
cursor: pointer;
margin-top: 15px;
transition: transform 0.2s;
}

#restartBtn:hover {
transform: scale(1.05);
}

#instructions {
position: absolute;
bottom: 20px;
left: 20px;
right: 20px;
color: rgba(255, 255, 255, 0.7);
font-size: 14px;
z-index: 10;
text-align: center;
}
</style>
```

</head>
<body>
<div id="gameContainer">
<canvas id="gameCanvas" width="400" height="600"></canvas>

```
<div id="ui">
<div>æ—¶é—´: <span id="timeDisplay">0.0</span>s</div>
<div>æœ€é«˜è®°å½•: <span id="bestTimeDisplay">0.0</span>s</div>
<div>ç›®æ ‡: åšæŒ20ç§’!</div>
</div>

<div id="gameOver">
<h2 id="gameOverTitle">æ¸¸æˆç»“æŸ!</h2>
<p>ä½ åšæŒäº† <span id="finalTime">0</span> ç§’</p>
<p id="bestRecord">æœ€é«˜è®°å½•: <span id="bestTimeResult">0</span> ç§’</p>
<p id="achievement"></p>
<button id="restartBtn">é‡æ–°å¼€å§‹</button>
</div>

<div id="instructions">
æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨æ§åˆ¶é£æœºæ–¹å‘<br>
èº²é¿å­å¼¹ï¼ŒåšæŒè¶Šä¹…è¶Šå¥½ï¼
</div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const timeDisplay = document.getElementById('timeDisplay');
const bestTimeDisplay = document.getElementById('bestTimeDisplay');
const gameOverDiv = document.getElementById('gameOver');
const gameOverTitle = document.getElementById('gameOverTitle');
const finalTimeSpan = document.getElementById('finalTime');
const bestTimeResult = document.getElementById('bestTimeResult');
const achievementP = document.getElementById('achievement');
const restartBtn = document.getElementById('restartBtn');

// æ¸¸æˆçŠ¶æ€
let gameRunning = false;
let gameTime = 0;
let bestTime = parseFloat(localStorage.getItem('bestTime')) || 0; // æœ€é«˜è®°å½•
let isNewRecord = false; // æ˜¯å¦åˆ›é€ äº†æ–°è®°å½•
let player = {
x: 200, // ç”»å¸ƒä¸­å¿ƒ 400/2
y: 300, // ç”»å¸ƒä¸­å¿ƒ 600/2
size: 12,
speed: 4,
vx: 0,
vy: 0,
alive: true
};
let bullets = [];
let stars = [];
let explosion = null;

// è§¦æ‘¸æ§åˆ¶
let lastTouchX = null;
let lastTouchY = null;
let isTouching = false;

// åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
function createStars() {
stars = [];
for (let i = 0; i < 60; i++) {
stars.push({
x: Math.random() * canvas.width,
y: Math.random() * canvas.height,
size: Math.random() * 2 + 0.5,
opacity: Math.random() * 0.8 + 0.2
});
}
}

// åˆ›å»ºå­å¼¹
function createBullet() {
const side = Math.floor(Math.random() * 4); // 0:ä¸Š, 1:å³, 2:ä¸‹, 3:å·¦
let bullet = {
size: 3,
speed: 1.5 + Math.random() * 1.5
};

switch (side) {
case 0: // ä»ä¸Šæ–¹
bullet.x = Math.random() * canvas.width;
bullet.y = -bullet.size;
bullet.dx = (player.x - bullet.x) * 0.008;
bullet.dy = bullet.speed;
break;
case 1: // ä»å³æ–¹
bullet.x = canvas.width + bullet.size;
bullet.y = Math.random() * canvas.height;
bullet.dx = -bullet.speed;
bullet.dy = (player.y - bullet.y) * 0.008;
break;
case 2: // ä»ä¸‹æ–¹
bullet.x = Math.random() * canvas.width;
bullet.y = canvas.height + bullet.size;
bullet.dx = (player.x - bullet.x) * 0.008;
bullet.dy = -bullet.speed;
break;
case 3: // ä»å·¦æ–¹
bullet.x = -bullet.size;
bullet.y = Math.random() * canvas.height;
bullet.dx = bullet.speed;
bullet.dy = (player.y - bullet.y) * 0.008;
break;
}

bullets.push(bullet);
}

// ç»˜åˆ¶æ˜Ÿç©º
function drawStars() {
ctx.fillStyle = 'white';
stars.forEach(star => {
ctx.globalAlpha = star.opacity;
ctx.beginPath();
ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
ctx.fill();
});
ctx.globalAlpha = 1;
}

// ç»˜åˆ¶ç©å®¶é£æœº
function drawPlayer() {
if (!player.alive) return;

ctx.save();
ctx.translate(player.x, player.y);

// é£æœºä¸»ä½“
ctx.fillStyle = '#4a9eff';
ctx.beginPath();
ctx.moveTo(0, -player.size);
ctx.lineTo(-player.size * 0.6, player.size * 0.8);
ctx.lineTo(0, player.size * 0.4);
ctx.lineTo(player.size * 0.6, player.size * 0.8);
ctx.closePath();
ctx.fill();

// é£æœºè£…é¥°
ctx.fillStyle = '#ff6b6b';
ctx.beginPath();
ctx.arc(0, 0, player.size * 0.3, 0, Math.PI * 2);
ctx.fill();

ctx.restore();
}

// ç»˜åˆ¶çˆ†ç‚¸æ•ˆæœ
function drawExplosion() {
if (!explosion) return;

ctx.save();
ctx.translate(explosion.x, explosion.y);

// çˆ†ç‚¸çš„å¤šä¸ªåœ†åœˆ
for (let i = 0; i < explosion.particles.length; i++) {
const particle = explosion.particles[i];

ctx.globalAlpha = particle.alpha;
ctx.fillStyle = particle.color;
ctx.beginPath();
ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
ctx.fill();

// çˆ†ç‚¸å…‰æ™•æ•ˆæœ
ctx.shadowColor = particle.color;
ctx.shadowBlur = particle.size * 2;
ctx.beginPath();
ctx.arc(particle.x, particle.y, particle.size * 0.5, 0, Math.PI * 2);
ctx.fill();
}

ctx.restore();
}

// ç»˜åˆ¶å­å¼¹
function drawBullets() {
ctx.fillStyle = '#ffaa00';
bullets.forEach(bullet => {
ctx.save();
ctx.shadowColor = '#ffaa00';
ctx.shadowBlur = 8;
ctx.beginPath();
ctx.arc(bullet.x, bullet.y, bullet.size, 0, Math.PI * 2);
ctx.fill();
ctx.restore();
});
}
function createExplosion(x, y) {
explosion = {
x: x,
y: y,
timer: 0,
duration: 120, // 2ç§’çš„çˆ†ç‚¸åŠ¨ç”»
particles: []
};

// åˆ›å»ºçˆ†ç‚¸ç²’å­
const colors = ['#ff4444', '#ff8844', '#ffaa44', '#ffff44', '#ff6666'];
for (let i = 0; i < 15; i++) {
explosion.particles.push({
x: (Math.random() - 0.5) * 20,
y: (Math.random() - 0.5) * 20,
vx: (Math.random() - 0.5) * 8,
vy: (Math.random() - 0.5) * 8,
size: Math.random() * 8 + 4,
color: colors[Math.floor(Math.random() * colors.length)],
alpha: 1,
life: Math.random() * 60 + 60
});
}
}

// æ›´æ–°çˆ†ç‚¸æ•ˆæœ
function updateExplosion() {
if (!explosion) return;

explosion.timer++;

// æ›´æ–°æ¯ä¸ªçˆ†ç‚¸ç²’å­
explosion.particles.forEach(particle => {
particle.x += particle.vx;
particle.y += particle.vy;
particle.vx *= 0.98; // ç©ºæ°”é˜»åŠ›
particle.vy *= 0.98;
particle.life--;
particle.alpha = Math.max(0, particle.life / 60);
particle.size *= 0.99; // ç²’å­é€æ¸ç¼©å°
});

// ç§»é™¤æ¶ˆå¤±çš„ç²’å­
explosion.particles = explosion.particles.filter(p => p.life > 0);

// çˆ†ç‚¸ç»“æŸåæ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
if (explosion.timer >= explosion.duration) {
explosion = null;
gameOverDiv.style.display = 'block';
}
}

// æ›´æ–°æ¸¸æˆé€»è¾‘
function update() {
// å¦‚æœæœ‰çˆ†ç‚¸æ•ˆæœåœ¨æ’­æ”¾ï¼Œåªæ›´æ–°çˆ†ç‚¸
if (explosion) {
updateExplosion();
return;
}

if (!gameRunning) return;

gameTime += 1/60;
timeDisplay.textContent = gameTime.toFixed(1);

// åªæœ‰é£æœºå­˜æ´»æ—¶æ‰ç§»åŠ¨
if (player.alive) {
// åº”ç”¨é£æœºç§»åŠ¨
player.x += player.vx;
player.y += player.vy;

// é€Ÿåº¦è¡°å‡
player.vx *= 0.92;
player.vy *= 0.92;

// è¾¹ç•Œé™åˆ¶
player.x = Math.max(player.size, Math.min(canvas.width - player.size, player.x));
player.y = Math.max(player.size, Math.min(canvas.height - player.size, player.y));
}

// åˆ›å»ºå­å¼¹ (éš¾åº¦é€’å¢)
const bulletFreq = Math.max(25 - Math.floor(gameTime * 2), 8);
if (Math.random() < 1/bulletFreq) {
createBullet();
}

// æ›´æ–°å­å¼¹
bullets = bullets.filter(bullet => {
bullet.x += bullet.dx;
bullet.y += bullet.dy;

// ç§»é™¤è¶…å‡ºè¾¹ç•Œçš„å­å¼¹
if (bullet.x < -30 || bullet.x > canvas.width + 30 ||
bullet.y < -30 || bullet.y > canvas.height + 30) {
return false;
}

// ç¢°æ’æ¤œæ¸¬ï¼ˆåªæœ‰é£æœºå­˜æ´»æ—¶æ‰æ£€æµ‹ï¼‰
if (player.alive) {
const dist = Math.sqrt(
(bullet.x - player.x) ** 2 + (bullet.y - player.y) ** 2
);
if (dist < player.size + bullet.size - 2) {
// é£æœºè¢«å‡»ä¸­ï¼Œå…ˆä¿å­˜æœ€ç»ˆæ—¶é—´å†åˆ›å»ºçˆ†ç‚¸æ•ˆæœ
player.alive = false;
gameRunning = false;
gameOver(); // å…ˆè°ƒç”¨gameOverä¿å­˜æ—¶é—´
createExplosion(player.x, player.y);
return false;
}
}

return true;
});
}

// æ¸²æŸ“æ¸¸æˆ
function render() {
ctx.clearRect(0, 0, canvas.width, canvas.height);

drawStars();
drawPlayer();
drawBullets();
drawExplosion(); // çˆ†ç‚¸æ•ˆæœ
}

// æ¸¸æˆå¾ªç¯
function gameLoop() {
update();
render();
requestAnimationFrame(gameLoop);
}

// æ¸¸æˆç»“æŸ
function gameOver() {
const currentTime = parseFloat(gameTime.toFixed(1));
finalTimeSpan.textContent = currentTime;

// æ£€æŸ¥æ˜¯å¦åˆ›é€ æ–°è®°å½•
if (currentTime > bestTime) {
bestTime = currentTime;
isNewRecord = true;
// ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
localStorage.setItem('bestTime', bestTime.toString());
// æ›´æ–°æ˜¾ç¤º
bestTimeDisplay.textContent = bestTime.toFixed(1);
}

// æ˜¾ç¤ºæœ€é«˜è®°å½•
bestTimeResult.textContent = bestTime.toFixed(1);

// è®¾ç½®æ ‡é¢˜å’Œæˆå°±æ–‡æœ¬
if (isNewRecord) {
gameOverTitle.textContent = 'ğŸ‰ æ–°è¨˜éŒ²é”æˆï¼';
gameOverTitle.className = 'newRecord';
} else {
gameOverTitle.textContent = 'ã‚²ãƒ¼ãƒ çµ‚äº†!';
gameOverTitle.className = '';
}

let achievement = '';
if (isNewRecord && currentTime >= 20) {
achievement = 'ğŸ† æ–°è¨˜éŒ²ã§20ç§’çªç ´ï¼ç´ æ™´ã‚‰ã—ã„ï¼';
} else if (isNewRecord) {
achievement = 'â­ æ–°è¨˜éŒ²é”æˆï¼ãŠã‚ã§ã¨ã†ï¼';
} else if (currentTime >= 20) {
achievement = 'ğŸ‰ ãŠã‚ã§ã¨ã†ï¼20ç§’çªç ´ï¼';
} else if (currentTime >= 15) {
achievement = 'ğŸ‘ ç´ æ™´ã‚‰ã—ã„ï¼ã‚‚ã†å°‘ã—ã§20ç§’ï¼';
} else if (currentTime >= 10) {
achievement = 'ğŸ‘ è‰¯ã„è¨˜éŒ²ï¼';
} else {
achievement = 'ğŸ’ª ç·´ç¿’ã‚’ç¶šã‘ã‚ˆã†ï¼';
}

achievementP.textContent = achievement;
// ä¸ç«‹å³æ˜¾ç¤ºï¼Œç­‰çˆ†ç‚¸åŠ¨ç”»ç»“æŸåæ˜¾ç¤º
}

// å¼€å§‹æ¸¸æˆ
function startGame() {
gameRunning = true;
gameTime = 0;
isNewRecord = false; // é‡ç½®æ–°è®°å½•æ ‡å¿—
// ç¡®ä¿ä»ç”»å¸ƒæ­£ä¸­å¿ƒå¼€å§‹
player.x = canvas.width / 2; // 200
player.y = canvas.height / 2; // 300
player.vx = 0;
player.vy = 0;
player.alive = true; // é‡ç½®é£æœºçŠ¶æ€
bullets = [];
explosion = null; // æ¸…é™¤çˆ†ç‚¸æ•ˆæœ
lastTouchX = null;
lastTouchY = null;
isTouching = false;
gameOverDiv.style.display = 'none';
}

// è·å–è§¦æ‘¸ä½ç½®
function getTouchPos(e) {
const rect = canvas.getBoundingClientRect();
const touch = e.touches[0] || e.changedTouches[0];
return {
x: (touch.clientX - rect.left) * (canvas.width / rect.width),
y: (touch.clientY - rect.top) * (canvas.height / rect.height)
};
}

// è§¦æ‘¸äº‹ä»¶ - é‡æ–°è®¾è®¡çš„æ§åˆ¶
canvas.addEventListener('touchstart', (e) => {
if (!gameRunning || !player.alive) return;

const pos = getTouchPos(e);
lastTouchX = pos.x;
lastTouchY = pos.y;
isTouching = true;

e.preventDefault();
});

canvas.addEventListener('touchmove', (e) => {
if (!gameRunning || !isTouching || !player.alive) return;

const pos = getTouchPos(e);

if (lastTouchX !== null && lastTouchY !== null) {
// è®¡ç®—æ‰‹æŒ‡ç§»åŠ¨çš„æ–¹å‘å’Œè·ç¦»
const deltaX = pos.x - lastTouchX;
const deltaY = pos.y - lastTouchY;

// å°†æ‰‹æŒ‡ç§»åŠ¨è½¬æ¢ä¸ºé£æœºé€Ÿåº¦
const sensitivity = 0.3;
player.vx += deltaX * sensitivity;
player.vy += deltaY * sensitivity;

// é™åˆ¶æœ€å¤§é€Ÿåº¦
const maxSpeed = player.speed;
const currentSpeed = Math.sqrt(player.vx * player.vx + player.vy * player.vy);
if (currentSpeed > maxSpeed) {
player.vx = (player.vx / currentSpeed) * maxSpeed;
player.vy = (player.vy / currentSpeed) * maxSpeed;
}
}

lastTouchX = pos.x;
lastTouchY = pos.y;

e.preventDefault();
});

canvas.addEventListener('touchend', (e) => {
isTouching = false;
lastTouchX = null;
lastTouchY = null;
e.preventDefault();
});

// é˜²æ­¢é¡µé¢æ»šåŠ¨
document.addEventListener('touchmove', (e) => {
e.preventDefault();
}, { passive: false });

// é‡å¯æŒ‰é’®
restartBtn.addEventListener('click', startGame);

// åˆå§‹åŒ–
createStars();
// æ˜¾ç¤ºæœ€é«˜è®°å½•
bestTimeDisplay.textContent = bestTime.toFixed(1);
startGame();
gameLoop();
</script>

</body>
</html>
